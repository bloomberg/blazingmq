<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libbmq: bmqa/bmqa_confirmeventbuilder.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libbmq<span id="projectnumber">&#160;7b01190bfb80b55301c841ed3a67c413c1564bda</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('bmqa__confirmeventbuilder_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle"><div class="title">bmqa_confirmeventbuilder.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Provide a builder for batching confirmation messages.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="bmqa__message_8h_source.html">bmqa_message.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="bmqt__resultcode_8h_source.html">bmqt_resultcode.h</a>&gt;</code><br />
<code>#include &lt;bdlbb_blob.h&gt;</code><br />
<code>#include &lt;bsls_alignedbuffer.h&gt;</code><br />
</div>
<p><a href="bmqa__confirmeventbuilder_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBloombergLP_1_1bmqa_1_1ConfirmEventBuilder.html">BloombergLP::bmqa::ConfirmEventBuilder</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mechanism to build a batch of CONFIRM messages.  <a href="classBloombergLP_1_1bmqa_1_1ConfirmEventBuilder.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="namespaces" name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespaceBloombergLP" id="r_namespaceBloombergLP"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceBloombergLP.html">BloombergLP</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:namespaceBloombergLP_1_1bmqa" id="r_namespaceBloombergLP_1_1bmqa"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceBloombergLP_1_1bmqa.html">BloombergLP::bmqa</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This component implements a mechanism, <a class="el" href="classBloombergLP_1_1bmqa_1_1ConfirmEventBuilder.html">bmqa::ConfirmEventBuilder</a>, that can be used for batching CONFIRM messages. The resulting batch can be sent to the BlazingMQ broker using the <a class="el" href="classBloombergLP_1_1bmqa_1_1Session.html">bmqa::Session</a> (refer to <a class="el" href="bmqa__session_8h.html">bmqa_session.h</a> for details). Wherever possible, a BlazingMQ consumer should try to send a batch of CONFIRM messages, which is more efficient than confirming messages individually.</p>
<p>The builder holds a batch of CONFIRM messages under construction, and provides two flavors of addMessageConfirmation method to add a CONFIRM message to the batch. It also provides a routine to retrieve number of CONFIRM messages added to the batch. Once application is done creating the batch, it can retrieve the blob (wire-representation) of the batch and send it via <a class="el" href="classBloombergLP_1_1bmqa_1_1Session.html">bmqa::Session</a>. See <a class="el" href="bmqa__confirmeventbuilder_8h.html#bmqa_confirmeventbuilder_usage">the usage section</a> for more details.</p>
<h1><a class="anchor" id="bmqa_confirmeventbuilder_usage"></a>
Usage</h1>
<ul>
<li>An instance of <a class="el" href="classBloombergLP_1_1bmqa_1_1ConfirmEventBuilder.html">bmqa::ConfirmEventBuilder</a> (the builder) can be used to create multiple batches of CONFIRM messages. The recommended approach is to create one instance of the builder and use it throughout the lifetime of the task (if the task is multi-threaded, an instance per thread must be created and maintained). See <a class="el" href="bmqa__confirmeventbuilder_8h.html#bmqa_confirmeventbuilder_ex1">usage example 1</a> for an illustration.</li>
<li>The lifetime of an instance of the builder is bound by the <a class="el" href="classBloombergLP_1_1bmqa_1_1Session.html">bmqa::Session</a> from which it was created. In other words, <a class="el" href="classBloombergLP_1_1bmqa_1_1Session.html">bmqa::Session</a> instance must outlive the builder instance.</li>
</ul>
<h2><a class="anchor" id="bmqa_confirmeventbuilder_ex1"></a>
Example 1 - Basic Usage</h2>
<div class="fragment"><div class="line"><span class="comment">// In this snippet, we will send a batch of CONFIRMs for all the</span></div>
<div class="line"><span class="comment">// &#39;bmqa::Message&#39; messages received in a &#39;bmqa::MessageEvent&#39;.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Note that error handling is omitted from the snippet for the sake of</span></div>
<div class="line"><span class="comment">// brevity.</span></div>
<div class="line"> </div>
<div class="line">bmqa::Session session;</div>
<div class="line">    <span class="comment">// Session start up logic elided.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create and load an instance of the ConfirmEventBuilder.  Note that in</span></div>
<div class="line"><span class="comment">// this example, we are creating the builder on the stack everytime a</span></div>
<div class="line"><span class="comment">// message event is received.  Another approach can be to maintain the</span></div>
<div class="line"><span class="comment">// builder as a data member and use it everytime.</span></div>
<div class="line"> </div>
<div class="line">bmqa::ConfirmEventBuilder builder;</div>
<div class="line">session.loadConfirmEventBuilder(&amp;builder);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assuming that a &#39;bmqa::MessageEvent&#39; is received.</span></div>
<div class="line"> </div>
<div class="line">bmqa::MessageIterator iter = messageEvent.messageIterator();</div>
<div class="line"><span class="keywordflow">while</span> (iter.nextMessage()) {</div>
<div class="line">    <span class="keyword">const</span> bmqa::Message&amp; msg = iter.message();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Business logic for processing &#39;msg&#39; elided.</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> rc = builder.addMessageConfirmation(msg);</div>
<div class="line">        <span class="comment">// Error handling elided.</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// All messages in the event have been processed and their corresponding</span></div>
<div class="line"><span class="comment">// CONFIRM messages have been batched.  Now its time to send the batch to</span></div>
<div class="line"><span class="comment">// the BlazingMQ broker.</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> rc = session.confirmMessages(&amp;builder);</div>
<div class="line">    <span class="comment">// Error handling elided.  Note that in case of success, above method</span></div>
<div class="line">    <span class="comment">// will also reset the &#39;builder&#39;.</span></div>
</div><!-- fragment --><h1><a class="anchor" id="bmqa_confirmeventbuilder_thread"></a>
Thread Safety</h1>
<p>This component is <em>NOT</em> thread safe. If it is desired to create a batch of CONFIRM messages from multiple threads, an instance of the builder must be created and maintained <em>per</em> <em>thread</em>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_e8cd90b45eb8e499a7a689fb69672d2e.html">bmqa</a></li><li class="navelem"><a class="el" href="bmqa__confirmeventbuilder_8h.html">bmqa_confirmeventbuilder.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
